<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fold 7 æˆ°æƒ…å®¤ v8.0</title>
  <style>
    /* --- å…¨å±€è¨­å®š --- */
    body { font-family: -apple-system, sans-serif; background: #f4f6f9; margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    
    /* --- é ‚éƒ¨å›ºå®šå€ --- */
    .header-container {
        background: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        z-index: 100;
        flex-shrink: 0;
        display: flex; flex-direction: column;
    }

    /* Row 0: æœå°‹ */
    .search-bar { padding: 10px 15px; display: flex; gap: 10px; border-bottom: 1px solid #f0f0f0; }
    .search-input { flex: 1; padding: 10px 15px; background: #f0f2f5; border: none; border-radius: 12px; font-size: 15px; }
    .btn-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 12px; background: #f0f2f5; cursor: pointer; color: #555; }

    /* Row 1: ä¸»æ¨¡å¼ */
    .level-1-wrapper { 
        padding: 10px 15px 5px 15px; 
        display: flex; gap: 8px; overflow-x: auto; 
        scrollbar-width: none; -ms-overflow-style: none;
    }
    .level-1-wrapper::-webkit-scrollbar { display: none; }

    .mode-btn {
        flex: 0 0 auto;
        padding: 8px 12px; border-radius: 20px; font-size: 14px; font-weight: bold;
        background: white; border: 1px solid #e0e0e0; color: #555;
        cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
    }
    .mode-btn.active { background: #333; color: white; border-color: #333; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transform: translateY(-1px); }
    
    /* è¨ˆæ•¸çƒ (ç¬¬ä¸€å±¤) */
    .count-badge-L1 {
        background: #eee; color: #666; font-size: 11px; padding: 1px 6px; 
        border-radius: 10px; min-width: 16px; text-align: center;
    }
    .mode-btn.active .count-badge-L1 { background: rgba(255,255,255,0.2); color: white; }

    /* ä¸åŒæ¨¡å¼çš„é«˜äº®è‰² */
    .mode-btn[data-mode="undispatched"].active { background: #007bff; border-color: #007bff; }
    .mode-btn[data-mode="dispatched"].active { background: #9c27b0; border-color: #9c27b0; }
    .mode-btn[data-mode="self"].active { background: #009688; border-color: #009688; }
    .mode-btn[data-mode="invalid"].active { background: #607d8b; border-color: #607d8b; }

    /* Row 2: ä¾†æºå­é¸å–® */
    .level-2-wrapper { 
        display: none; padding: 5px 15px; gap: 10px; background: #f8f9fa; border-bottom: 1px solid #eee;
        animation: slideDown 0.2s ease-out;
    }
    .level-2-wrapper.show { display: flex; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

    .source-tab {
        flex: 1; text-align: center; padding: 8px 0; border-radius: 8px; 
        color: #666; font-weight: bold; font-size: 13px; cursor: pointer;
        background: white; border: 1px solid #ddd; transition: 0.2s;
        display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .source-tab.active { background: #e3f2fd; color: #007bff; border-color: #007bff; box-shadow: 0 2px 4px rgba(0,123,255,0.1); }
    
    /* è¨ˆæ•¸çƒ (ç¬¬äºŒå±¤) */
    .count-badge-L2 {
        background: rgba(0,0,0,0.1); font-size: 11px; padding: 1px 6px; 
        border-radius: 10px; min-width: 14px; text-align: center;
    }
    .source-tab.active .count-badge-L2 { background: #007bff; color: white; }

    /* Row 3: ç‹€æ…‹/äººå“¡ä¸¸å­ */
    .level-3-wrapper { 
        padding: 10px 15px; display: flex; gap: 8px; overflow-x: auto; 
        background: white; min-height: 45px; align-items: center;
        border-bottom: 1px solid #f0f0f0;
    }
    .level-3-wrapper::-webkit-scrollbar { display: none; }

    .filter-pill {
        flex: 0 0 auto; padding: 6px 12px; border-radius: 16px; font-size: 13px; font-weight: bold;
        background: #f5f5f5; color: #666; cursor: pointer; transition: 0.2s;
        display: flex; align-items: center; gap: 6px;
    }
    .filter-pill.active { background: #333; color: white; }
    
    /* è¨ˆæ•¸çƒ (ç¬¬ä¸‰å±¤) */
    .count-badge-L3 {
        background: #ddd; color: #555; font-size: 10px; padding: 1px 5px; 
        border-radius: 8px; min-width: 12px; text-align: center;
    }
    .filter-pill.active .count-badge-L3 { background: rgba(255,255,255,0.3); color: white; }

    /* é¡è‰²å®šç¾© */
    .pill-new.active { background: #ff3547; }
    .pill-unread.active { background: #ffbb33; color: #333; }
    .pill-read.active { background: #00C851; }
    .pill-agent.active { background: #9c27b0; }

    /* --- åˆ—è¡¨å€ --- */
    .list-area { flex: 1; overflow-y: auto; padding: 15px; }

    .card {
        background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.04); display: flex; align-items: center;
        border-left: 5px solid #ccc; position: relative;
    }
    .c-ads { border-left-color: #007bff; }
    .c-seminar { border-left-color: #ff9800; }
    .c-self { border-left-color: #009688; }
    
    .card-main { flex: 1; }
    .card-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 4px; }
    .card-sub { font-size: 11px; color: #888; display: flex; gap: 8px; align-items: center; }
    .tag { background: #eee; padding: 2px 6px; border-radius: 4px; }

  </style>
</head>
<body>

  <div class="header-container">
    
    <div class="search-bar">
      <input type="text" class="search-input" placeholder="ğŸ” æœå°‹åº—åã€é›»è©±...">
      <div class="btn-icon">ğŸ”„</div>
    </div>

    <div class="level-1-wrapper">
      <div class="mode-btn active" data-mode="undispatched" onclick="setMode('undispatched')">
        ğŸ“‚ æœªæ´¾å–® <span class="count-badge-L1" id="c1-undispatched">0</span>
      </div>
      <div class="mode-btn" data-mode="dispatched" onclick="setMode('dispatched')">
        ğŸš€ å·²æ´¾å–® <span class="count-badge-L1" id="c1-dispatched">0</span>
      </div>
      <div class="mode-btn" data-mode="self" onclick="setMode('self')">
        ğŸ¢ è‡ªé–‹ä»¶ <span class="count-badge-L1" id="c1-self">0</span>
      </div>
      <div class="mode-btn" data-mode="invalid" onclick="setMode('invalid')">
        ğŸ—‘ï¸ ç„¡æ•ˆå–® <span class="count-badge-L1" id="c1-invalid">0</span>
      </div>
    </div>

    <div class="level-2-wrapper" id="sourceRow">
      <div class="source-tab active" data-src="ads" onclick="setSource('ads')">
          ğŸ“¢ å»£å‘Šä»¶ <span class="count-badge-L2" id="c2-ads">0</span>
      </div>
      <div class="source-tab" data-src="seminar" onclick="setSource('seminar')">
          ğŸ¤ è¬›åº§ä»¶ <span class="count-badge-L2" id="c2-seminar">0</span>
      </div>
    </div>

    <div class="level-3-wrapper" id="filterRow">
      </div>

  </div>

  <div class="list-area" id="list"></div>

<script>
  // --- æ¨¡æ“¬è³‡æ–™åº« ---
  const db = [
    // æœªæ´¾å–® (å»£å‘Š)
    { name: "ç¾å¥½æ™‚å…‰SPA", mode: "undispatched", source: "ads", status: "new", tag:"æ–°å–®" },
    { name: "å°æ—çœ¼é¡", mode: "undispatched", source: "ads", status: "noline", tag:"æ²’Line" },
    // æœªæ´¾å–® (è¬›åº§)
    { name: "æ¥µç·»é«®è—", mode: "undispatched", source: "seminar", status: "unread", tag:"æœªè®€" },

    // å·²æ´¾å–® (David, Kelvin)
    { name: "æ”¾é¬†æ¨æ‹¿", mode: "dispatched", source: "ads", agent: "David", tag:"David" },
    { name: "é˜¿å¼·ç†é«®", mode: "dispatched", source: "seminar", agent: "Kelvin", tag:"Kelvin" },
    { name: "æ¸¬è©¦B", mode: "dispatched", source: "ads", agent: "Kelvin", tag:"Kelvin" },
    
    // è‡ªé–‹ä»¶ (WT)
    { name: "è€ç‹ç‰›è‚‰éºµ", mode: "self", source: "self", agent: "WT", tag:"WTé–‹ç™¼" },

    // ç„¡æ•ˆå–®
    { name: "ç„¡æ•ˆA", mode: "invalid", source: "ads", status: "read", tag:"å·²è®€" }
  ];

  // --- App ç‹€æ…‹ ---
  let appState = {
    mode: 'undispatched',
    source: 'ads',
    filter: 'new' 
  };

  // --- æ ¸å¿ƒè¨ˆæ•¸åŠŸèƒ½ ---
  function updateGlobalCounts() {
    // 1. æ›´æ–°ç¬¬ä¸€å±¤è¨ˆæ•¸ (L1)
    ['undispatched', 'dispatched', 'self', 'invalid'].forEach(m => {
        const count = db.filter(d => d.mode === m).length;
        document.getElementById(`c1-${m}`).innerText = count;
    });

    // 2. æ›´æ–°ç¬¬äºŒå±¤è¨ˆæ•¸ (L2) - æ ¹æ“šç•¶å‰ mode (åªå° æœªæ´¾å–® & ç„¡æ•ˆå–® æœ‰æ„ç¾©)
    if (appState.mode === 'undispatched' || appState.mode === 'invalid') {
        const adsCount = db.filter(d => d.mode === appState.mode && d.source === 'ads').length;
        const semCount = db.filter(d => d.mode === appState.mode && d.source === 'seminar').length;
        document.getElementById(`c2-ads`).innerText = adsCount;
        document.getElementById(`c2-seminar`).innerText = semCount;
    }
  }

  // --- å–å¾—ç¬¬ä¸‰å±¤å–®ä¸€é …ç›®çš„è¨ˆæ•¸ ---
  function getL3Count(filterKey) {
    return db.filter(d => {
        // å…ˆç¯© mode
        if (d.mode !== appState.mode) return false;

        // å†ç¯© source (å¦‚æœæ˜¯æœªæ´¾å–®/ç„¡æ•ˆå–®)
        if (appState.mode === 'undispatched' || appState.mode === 'invalid') {
            if (d.source !== appState.source) return false;
            return d.status === filterKey;
        } 
        // æ´¾å–®/è‡ªé–‹ (ç¯© agent)
        else {
            return d.agent === filterKey;
        }
    }).length;
  }

  // --- 1. åˆ‡æ›ä¸»æ¨¡å¼ ---
  function setMode(mode) {
    appState.mode = mode;
    
    // é è¨­é¸æ“‡é‚è¼¯ (ç§»é™¤å…¨éƒ¨ï¼Œé è¨­é¸ç¬¬ä¸€å€‹æœ‰æ„ç¾©çš„)
    if (mode === 'undispatched' || mode === 'invalid') {
        appState.filter = 'new';
        appState.source = 'ads'; // é‡ç½®ä¾†æº
    } else {
        // å·²æ´¾å–® / è‡ªé–‹ä»¶ -> é è¨­é¸ Kelvin (æˆ–å…¶ä»–ç¬¬ä¸€é †ä½)
        appState.filter = 'Kelvin';
    }

    // UI æ›´æ–°
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');

    const row2 = document.getElementById('sourceRow');
    if (mode === 'undispatched' || mode === 'invalid') {
        row2.classList.add('show');
        document.querySelectorAll('.source-tab').forEach(t => t.classList.remove('active'));
        document.querySelector('.source-tab[data-src="ads"]').classList.add('active');
    } else {
        row2.classList.remove('show');
    }

    updateGlobalCounts();
    renderFilters();
    renderList();
  }

  // --- 2. åˆ‡æ›ä¾†æº ---
  function setSource(src) {
    appState.source = src;
    appState.filter = 'new'; // åˆ‡æ›ä¾†æºæ™‚ï¼Œé è¨­å›æ–°å–®
    
    document.querySelectorAll('.source-tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.source-tab[data-src="${src}"]`).classList.add('active');
    
    updateGlobalCounts(); // æ›´æ–° L2 æ•¸å­— (å…¶å¯¦ä¸ç”¨ï¼Œä½†ç‚ºäº†ä¿éšª)
    renderFilters(); 
    renderList();
  }

  // --- 3. åˆ‡æ›éæ¿¾ ---
  function setFilter(val) {
    appState.filter = val;
    renderFilters(); // ç‚ºäº†æ›´æ–° active æ¨£å¼
    renderList();
  }

  // --- æ¸²æŸ“ Row 3 (Pills) ---
  function renderFilters() {
    const container = document.getElementById('filterRow');
    let pills = [];
    let styleClass = '';

    // æƒ…å¢ƒ A: æœªæ´¾å–® OR ç„¡æ•ˆå–® (Status)
    if (appState.mode === 'undispatched' || appState.mode === 'invalid') {
      styleClass = (k) => k==='new'?'pill-new':(k==='unread'?'pill-unread':(k==='read'?'pill-read':''));
      pills = [
        {k:'new', t:'ğŸ”´ æ–°å–®'},
        {k:'unread', t:'ğŸŸ¡ æœªè®€'},
        {k:'read', t:'ğŸŸ¢ å·²è®€'},
        {k:'noline', t:'âšª æ²’Line'}
      ];
    }
    // æƒ…å¢ƒ B: å·²æ´¾å–® OR è‡ªé–‹ä»¶ (Agent)
    else if (appState.mode === 'dispatched' || appState.mode === 'self') {
      styleClass = () => 'pill-agent';
      pills = [
        {k:'Kelvin', t:'ğŸ‘¤ Kelvin'},
        {k:'David', t:'ğŸ‘¤ David'},
        {k:'WT', t:'ğŸ‘¤ WT'}
      ];
    }

    // ç”¢ç”Ÿ HTML (åŠ å…¥è¨ˆæ•¸)
    container.innerHTML = pills.map(p => {
        const count = getL3Count(p.k);
        return `
            <div class="filter-pill ${styleClass(p.k)} ${appState.filter===p.k?'active':''}" 
                 onclick="setFilter('${p.k}')">
                 ${p.t} <span class="count-badge-L3">${count}</span>
            </div>
        `;
    }).join('');
  }

  // --- æ¸²æŸ“åˆ—è¡¨ ---
  function renderList() {
    const list = document.getElementById('list');
    
    const res = db.filter(d => {
      if (d.mode !== appState.mode) return false;
      
      if (appState.mode === 'undispatched' || appState.mode === 'invalid') {
        if (d.source !== appState.source) return false;
        if (d.status !== appState.filter) return false; // å¼·åˆ¶éæ¿¾ status
      } else {
        if (d.agent !== appState.filter) return false; // å¼·åˆ¶éæ¿¾ agent
      }
      return true;
    });

    if (res.length === 0) {
      list.innerHTML = '<div style="text-align:center; padding:40px; color:#ccc;">ğŸ“­ æ­¤åˆ†é¡ç„¡è³‡æ–™</div>';
      return;
    }

    list.innerHTML = res.map(d => `
      <div class="card c-${d.source === 'self' ? 'self' : 'ads'}">
        <div class="card-main">
          <div class="card-title">${d.name}</div>
          <div class="card-sub">
             <span class="tag">${d.tag}</span>
             <span>${getDesc(d)}</span>
          </div>
        </div>
        <button style="width:36px; height:36px; border-radius:50%; border:none; background:#f0f2f5;">ğŸ“</button>
      </div>
    `).join('');
  }

  function getDesc(d) {
    if (d.mode === 'dispatched' || d.mode === 'self') return `è² è²¬äºº: ${d.agent}`;
    return `${d.source==='ads'?'å»£å‘Š':'è¬›åº§'}ä¾†å®¢`;
  }

  // Init
  updateGlobalCounts();
  setMode('undispatched');

</script>
</body>
</html>
