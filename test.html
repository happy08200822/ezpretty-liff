<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ezPretty é–‹ç™¼å°å¼•å° (Fold 7 å¼·åŒ–ç‰ˆ)</title>
  <style>
    /* --- 1. åŸºç¤èƒŒæ™¯èˆ‡ HUD --- */
    body { font-family: -apple-system, "Noto Sans TC", sans-serif; background: #f0f2f5; padding: 15px; margin: 0; -webkit-tap-highlight-color: transparent; }
    
    #hud { 
        position: fixed; top: 15px; left: 50%; transform: translateX(-50%) translateY(-150%);
        width: 90%; max-width: 400px; background: linear-gradient(135deg, #FF8008 0%, #FFC837 100%);
        color: white; border-radius: 50px; padding: 8px 15px 8px 22px;
        display: flex; align-items: center; justify-content: space-between;
        z-index: 11000; box-shadow: 0 10px 25px rgba(255, 128, 8, 0.3);
        font-size: 14px; font-weight: bold; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    #hud.show { transform: translateX(-50%) translateY(0); }
    .hud-btn { background: white; color: #FF8008; border: none; padding: 6px 14px; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: bold; }

    /* --- 2. ç»ç’ƒè³ªæ„Ÿå½ˆçª— --- */
    .bottom-sheet { 
        position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); 
        border-radius: 30px 30px 0 0; z-index: 10000; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1); 
        padding: 0; overflow: hidden; box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
    }
    .bottom-sheet.show { transform: translateY(0); }

    .sheet-header-box { background: #fff; padding: 20px 20px 15px 20px; border-bottom: 1px solid #eee; text-align: center; position: relative; }
    .current-store-title { font-size: 20px; font-weight: 900; color: #2c3e50; margin: 0; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .sheet-close-btn { position: absolute; right: 15px; top: 15px; font-size: 24px; color: #ccc; cursor: pointer; border: none; background: none; }

    /* --- 3. å››æ­¥å°å¼•èˆ‡ç†„ç‡ˆé‚è¼¯ --- */
    .guide-scroll-area { padding: 20px; max-height: 85vh; overflow-y: auto; padding-bottom: 50px; }
    .step-box { display: flex; gap: 12px; position: relative; margin-bottom: 15px; }
    .step-box:not(:last-child)::after { content: ''; position: absolute; left: 14px; top: 35px; width: 2px; height: calc(100% - 15px); background: #007bff; transition: background 0.5s; z-index: 1; }
    .step-box.done:not(:last-child)::after { background: #e0e0e0; }

    .step-num { min-width: 30px; height: 30px; border-radius: 50%; background: #007bff; color: white; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; z-index: 2; transition: all 0.3s; }
    .step-box.done .step-num { background: #dcdde1; color: #7f8c8d; }
    .step-box.done .step-title { color: #bdc3c7; }

    .step-content { flex: 1; }
    .step-title { font-size: 14px; font-weight: bold; color: #555; margin-bottom: 8px; display: block; transition: color 0.3s; }

    /* æŒ‰éˆ•æ¨£å¼ */
    .line-jump-btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 18px; font-weight: 700; color: #fff; background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); padding: 12px; border-radius: 12px; cursor: pointer; text-decoration: none; width: 100%; box-sizing: border-box; box-shadow: 0 4px 12px rgba(0,123,255,0.2); }
    .tag-btn-group { display: flex; gap: 10px; }
    .tag-btn { flex: 1; padding: 10px; background: #fff; border: 1.5px solid #dee2e6; border-radius: 10px; font-size: 13px; font-weight: bold; cursor: pointer; text-align: center; }
    .card-img-preview { width: 100%; max-width: 260px; border-radius: 10px; border: 2px solid #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: grab; }

    /* è©±è¡“å€ */
    .script-tabs { display: flex; background: #eee; border-radius: 10px; padding: 3px; margin-bottom: 10px; gap: 3px; }
    .tab-btn { flex: 1; padding: 8px; border: none; border-radius: 7px; font-size: 12px; font-weight: bold; cursor: pointer; color: #777; }
    .tab-btn.active { background: #fff; color: #007bff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .staff-row { display: none; gap: 8px; margin-bottom: 10px; justify-content: flex-end; }
    .staff-chip { padding: 4px 12px; border-radius: 20px; font-size: 11px; border: 1px solid #007bff; color: #007bff; cursor: pointer; }
    .staff-chip.active { background: #007bff; color: white; }
    .line-textarea { width: 100%; height: 120px; border: 1.5px solid #eee; border-radius: 15px; padding: 12px; font-size: 14px; line-height: 1.5; resize: none; margin-bottom: 10px; box-sizing: border-box; background: #fafafa; }
    .btn-final-go { width: 100%; padding: 16px; border-radius: 15px; border: none; background: linear-gradient(135deg, #00b894 0%, #009432 100%); color: white; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 8px 20px rgba(0,184,148,0.2); }
  </style>
</head>
<body>

  <div id="hud">
      <span>â³ èŠå®Œè¨˜å¾—å›ä¾†æ›´æ–°é€²åº¦ï¼</span>
      <button class="hud-btn" onclick="closeHUD()">âœ•</button>
  </div>

  <div style="text-align:center; padding-top:100px;">
    <button onclick="openLineModal('æ„›æ´›é›…æ™‚å°šç¾å­¸', 'love_aloya', '0912345678', 'é ç´„ç³»çµ±èˆ‡è–ªè³‡è¨ˆç®—', 'å°ä¸­')" style="padding:15px 30px; border-radius:15px; background:#00C851; color:white; border:none; font-weight:bold; cursor:pointer;">
        ğŸš€ é–‹å§‹è¯çµ¡åº—å®¶ (æ¸¬è©¦)
    </button>
  </div>

  <div class="bottom-sheet" id="lineModal">
      <div class="sheet-header-box">
          <button class="sheet-close-btn" onclick="closeLineModal()">âœ•</button>
          <p class="current-store-title">ğŸ  <span id="displayStoreName">--</span></p>
      </div>

      <div class="guide-scroll-area">
          <div class="guide-container">
              <div class="step-box" id="step1">
                  <div class="step-num">1</div>
                  <div class="step-content">
                      <span class="step-title">é»æ“Š ID åŠ å¥½å‹ (è·³è½‰ LINE)</span>
                      <a id="lineJumpBtn" href="#" class="line-jump-btn" target="_blank" onclick="markDone(1)">
                          <span id="lineInfoIcon">ğŸ†”</span> <span id="lineInfoText">ID è¼‰å…¥ä¸­</span>
                      </a>
                  </div>
              </div>
              <div class="step-box" id="step2">
                  <div class="step-num">2</div>
                  <div class="step-content">
                      <span class="step-title">è¤‡è£½æš±ç¨± (è¨˜å¾—åœ¨ LINE ä¿®æ”¹åå­—)</span>
                      <div class="tag-btn-group">
                          <div class="tag-btn" id="tagUser" onclick="copyNick('user'); markDone(2)">ğŸ‘¤ æš±ç¨±</div>
                          <div class="tag-btn" id="tagTeacher" onclick="copyNick('teacher'); markDone(2)">ğŸ§‘â€ğŸ« æš±ç¨±</div>
                      </div>
                  </div>
              </div>
              <div class="step-box" id="step3">
                  <div class="step-num">3</div>
                  <div class="step-content">
                      <span class="step-title">å‚³é€åç‰‡ (é•·æŒ‰æ‹–æ›³è‡³å³å´è¦–çª—)</span>
                      <img src="https://happy08200822.github.io/ezpretty-liff/card.jpg" class="card-img-preview" draggable="true" ondragstart="markDone(3)">
                  </div>
              </div>
              <div class="step-box" id="step4">
                  <div class="step-num">4</div>
                  <div class="step-content">
                      <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span class="step-title">è¤‡è£½è©±è¡“ä¸¦ç™¼é€</span>
                        <div class="staff-row" id="staffSelector">
                            <div class="staff-chip active" id="chipK" onclick="selectS('Kelvin')">Kelvin</div>
                            <div class="staff-chip" id="chipD" onclick="selectS('David')">David</div>
                        </div>
                      </div>
                      <div class="script-tabs">
                          <button class="tab-btn active" onclick="setS('first')">åˆæ¬¡</button>
                          <button class="tab-btn" onclick="setS('follow')">äºŒæ•²</button>
                          <button class="tab-btn" onclick="setS('success')">é‚€ç´„</button>
                      </div>
                      <textarea id="lineScriptArea" class="line-textarea"></textarea>
                      <button class="btn-final-go" onclick="copyAndGoLine(); markDone(4)">ğŸš€ è¤‡è£½ä¸¦è·³å› LINE</button>
                  </div>
              </div>
          </div>
      </div>
  </div>

<script>
    let cur = { name: "", req: "", area: "", staff: "Kelvin", tab: "first" };

    function openLineModal(name, lid, ph, req, area) {
        for(let i=1; i<=4; i++) { document.getElementById(`step${i}`).classList.remove('done'); }
        document.getElementById('displayStoreName').innerText = name;
        cur = { name, req, area, staff: "Kelvin", tab: "first" };
        const idVal = lid !== "--" ? lid : ph;
        document.getElementById('lineInfoText').innerText = idVal;
        document.getElementById('lineJumpBtn').href = `https://line.me/ti/p/~${idVal}`;
        document.getElementById('tagUser').innerText = `ğŸ‘¤ ${name}-`;
        document.getElementById('tagTeacher').innerText = `ğŸ§‘â€ğŸ« ${name}-`;
        setS('first');
        document.getElementById('lineModal').classList.add('show');
    }

    function markDone(step) { document.getElementById(`step${step}`).classList.add('done'); }

    function copyNick(type) {
        const prefix = type === 'user' ? 'ğŸ‘¤' : 'ğŸ§‘â€ğŸ«';
        navigator.clipboard.writeText(`${prefix}${cur.name}-`);
        const id = type === 'user' ? 'tagUser' : 'tagTeacher';
        const old = document.getElementById(id).innerText;
        document.getElementById(id).innerText = "âœ… å·²è¤‡è£½";
        setTimeout(() => { document.getElementById(id).innerText = old; }, 1200);
    }

    function setS(type) {
        cur.tab = type;
        document.getElementById('staffSelector').style.display = (type === 'success') ? 'flex' : 'none';
        const btns = document.querySelectorAll('.tab-btn');
        btns.forEach((b, i) => b.classList.toggle('active', (i===0 && type==='first') || (i===1 && type==='follow') || (i===2 && type==='success')));
        gen();
    }

    function selectS(s) {
        cur.staff = s;
        document.getElementById('chipK').classList.toggle('active', s === 'Kelvin');
        document.getElementById('chipD').classList.toggle('active', s === 'David');
        gen();
    }

    function gen() {
        const { name, req, area, staff, tab } = cur;
        const r = req || "ç›¸é—œ";
        const textarea = document.getElementById('lineScriptArea');
        if (tab === 'first') textarea.value = `å“ˆå›‰ è€é—† æ‚¨å¥½ï¼æ‚¨é€™é‚Šæ˜¯ ${name} åº—å®¶å—ï½\næˆ‘æ˜¯ ezPretty é ç´„ç§‘æŠ€çš„æ¥­å‹™ç¶“ç† æšåº­ ğŸ˜Š\nå‰›æ‰æœ‰æ”¶åˆ°æ‚¨çš„è«®è©¢ï¼Œæ‚¨æƒ³äº†è§£æˆ‘å€‘é ç´„posç³»çµ±çš„ã€${r}ã€‘çš„åŠŸèƒ½å—ï¼Ÿ\n\næ‚¨çœ‹åˆ°è¨Šæ¯å¾Œï¼Œæ–¹ä¾¿è·Ÿæ‚¨é€šè©±1åˆ†é˜å—ï¼Ÿ`;
        else if (tab === 'follow') textarea.value = `å“ˆå›‰è€é—†ï¼Œæ“”å¿ƒæ‚¨è¿‘æ—¥å¿™ç¢Œæ¼æ‰è¨Šæ¯ï¼Œæ‰€ä»¥å†è·Ÿæ‚¨æ‰“å€‹æ‹›å‘¼ ğŸ˜Š\n\nè¿‘æœŸæœ‰æ”¶åˆ°æ‚¨çš„è«®è©¢ï¼Œæ‚¨æƒ³äº†è§£æˆ‘å€‘é ç´„posç³»çµ±çš„ã€${r}ã€‘çš„åŠŸèƒ½å—ï¼Ÿ`;
        else if (tab === 'success') textarea.value = `å¥½çš„ï¼Œæˆ‘å¾…æœƒæ‹‰å€‹ç¾¤çµ„ï¼Œæˆ‘è«‹æˆ‘çš„çµ„å“¡ ${staff} å’Œæ‚¨ç´„æ™‚é–“ä»‹ç´¹ç³»çµ±å”·ï¼\nç¾¤çµ„åç¨±æ˜¯ ã€${area}${name}ï¼ˆï¼¤ï¼¥ï¼‰+ ezPrettyè¨è«–ã€\n\næ‚¨å†ç•™æ„ä¸€ä¸‹ç¾¤çµ„çš„è¨Šæ¯å”·ï½`;
    }

    function copyAndGoLine() {
        navigator.clipboard.writeText(document.getElementById('lineScriptArea').value).then(() => {
            document.getElementById('hud').classList.add('show');
            const intentUrl = "intent://#Intent;scheme=line;package=jp.naver.line.android;end";
            try { window.location.assign(intentUrl); } catch (e) { window.location.href = "line://"; }
        });
    }

    function closeLineModal() { document.getElementById('lineModal').classList.remove('show'); }
    function closeHUD() { document.getElementById('hud').classList.remove('show'); }
</script>
</body>
</html>
