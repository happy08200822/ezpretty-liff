<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ezPretty é–‹ç™¼æˆ°æƒ…å®¤</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: -apple-system, "Noto Sans TC", sans-serif; background: #f4f6f9; padding: 10px; margin: 0; }
    .header-sticky { position: sticky; top: 0; background: #f4f6f9; z-index: 100; padding-bottom: 10px; }
    .search-input { width: 100%; padding: 12px 20px; border-radius: 25px; border: none; box-sizing: border-box; font-size: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 12px; }

    /* 4 å¤§åˆ†é¡æŒ‰éˆ• */
    .filter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .filter-btn { padding: 10px 5px; border-radius: 12px; border: none; font-weight: bold; color: white; text-align: center; font-size: 13px; cursor: pointer; transition: 0.2s; }
    .btn-ice { background: #5D9CEC; } .btn-stall { background: #FFCE54; color: #656D78; }
    .btn-hot { background: #ED5565; } .btn-dead { background: #AAB2BD; }
    .filter-btn.active { box-shadow: 0 0 0 3px #434A54; transform: scale(0.98); }

    /* åº—å®¶å¡ç‰‡ */
    .store-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 6px solid #ccc; }
    .card-ice { border-top-color: #5D9CEC; } .card-stall { border-top-color: #FFCE54; }
    .card-hot { border-top-color: #ED5565; } .card-dead { border-top-color: #AAB2BD; }

    /* 12 ç¨®ç´°ç¯€æ¨™ç±¤ */
    .detail-label { display: inline-block; background: #434A54; color: white; font-size: 11px; padding: 2px 10px; border-radius: 20px; margin-bottom: 10px; }

    .store-name { font-size: 19px; font-weight: bold; color: #333; margin-bottom: 8px; }
    .key-badge { font-size: 11px; color: #999; font-weight: normal; }

    /* B-K å®Œæ•´è³‡è¨Šå€ */
    .info-box { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; font-size: 13px; color: #555; background: #f8faff; padding: 12px; border-radius: 12px; border: 1px solid #eef2f7; }
    .info-item b { color: #333; }
    .full-row { grid-column: span 2; border-top: 1px solid #edf1f7; padding-top: 6px; margin-top: 4px; }

    .status-tags { display: flex; gap: 6px; margin: 12px 0; flex-wrap: wrap; }
    .tag { font-size: 11px; padding: 3px 8px; border-radius: 6px; background: #e9ecef; }

    /* å‹•ä½œæŒ‰éˆ•çµ„ */
    .action-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px; }
    .btn-tool { display: flex; flex-direction: column; align-items: center; padding: 8px 0; border-radius: 12px; border: 1px solid #ddd; font-size: 10px; font-weight: bold; text-decoration: none; color: #444; background: #fff; transition: 0.2s; }
    .btn-tool i { font-size: 18px; margin-bottom: 2px; }
    .btn-call { background: #eafaf1; border-color: #2ecc71; color: #27ae60; }
    .btn-line { background: #ebf9f0; border-color: #06C755; color: #06C755; }
  </style>
</head>
<body>

  <div class="header-sticky">
    <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” æœå°‹åº—åã€è² è²¬äººæˆ–å–®è™Ÿ..." oninput="render()">
    <div class="filter-grid">
      <div class="filter-btn btn-ice active" id="f-ice" onclick="setFilter('ice')">ğŸ§Š å†°å°<span>å…¨æ–°åå–®</span></div>
      <div class="filter-btn btn-stall" id="f-stall" onclick="setFilter('stall')">âš¡ åƒµå±€<span>å·²åŠ è³´/ä¸å›</span></div>
      <div class="filter-btn btn-hot" id="f-hot" onclick="setFilter('hot')">ğŸ”¥ ç†±åº¦<span>é›»è©±å·²é€š</span></div>
      <div class="filter-btn btn-dead" id="f-dead" onclick="setFilter('dead')">âš ï¸ ç€•æ­»<span>æ‹›å¼ç”¨ç›¡</span></div>
    </div>
  </div>

  <div id="storeList">
    <div style="text-align:center; padding:50px; color:#999;">åå–®è¼‰å…¥ä¸­...</div>
  </div>

<script>
  let allData = [];
  let currentFilter = 'ice';

  // 1. åˆå§‹åŒ–è®€å–å¾Œç«¯è³‡æ–™
  async function loadData() {
    // ğŸŒŸ å·²åŠ ä¸Š action åƒæ•¸ï¼Œç¢ºä¿ GAS å›å‚³ JSON è³‡æ–™
    const gasUrl = "https://script.google.com/macros/s/AKfycbzIKHpWcWj0bOhaQsx-OynY5FVVorMJvTNON5PBOywj1q-Nd5EylLCSl-zTlFW9Rb5U/exec?action=getManagementList";
    
    try {
      const response = await fetch(gasUrl);
      allData = await response.json();
      render();
    } catch (e) {
      console.error(e);
      document.getElementById('storeList').innerHTML = `<div style="text-align:center; padding:20px; color:red;">è¼‰å…¥å¤±æ•—<br><small>${e.message}</small></div>`;
    }
  }

  // 2. æ¸²æŸ“æ¸…å–®
  function render() {
    const list = document.getElementById('storeList');
    const search = document.getElementById('searchInput').value.toLowerCase();
    
    const filtered = allData.filter(i => {
      // æ”¯æ´æœå°‹ï¼šåº—åã€è² è²¬äººã€å–®è™Ÿã€åœ°å€
      const matchSearch = i.name.toLowerCase().includes(search) || 
                          i.boss.toLowerCase().includes(search) || 
                          i.key.toLowerCase().includes(search) ||
                          i.area.toLowerCase().includes(search);
      const matchFilter = i.type === currentFilter;
      return matchSearch && matchFilter;
    });

    if (filtered.length === 0) {
      list.innerHTML = '<div style="text-align:center; padding:50px; color:#999;">æ­¤åˆ†é¡æš«ç„¡åŒ¹é…åå–®</div>';
      return;
    }

    list.innerHTML = filtered.map(item => `
      <div class="store-card card-${item.type}">
        <div class="detail-label">ğŸ“ ${item.detailLabel}</div>
        <div class="store-name">
          [${item.area}] ${item.name} <span class="key-badge">#${item.key}</span>
        </div>
        
        <div class="info-box">
          <div class="info-item"><b>ä¾†æº:</b> ${item.source}</div>
          <div class="info-item"><b>å¡«å–®æ—¥:</b> ${item.date}</div>
          <div class="info-item"><b>ç”¢æ¥­:</b> ${item.industry}</div>
          <div class="info-item"><b>è² è²¬äºº:</b> ${item.boss}</div>
          <div class="info-item"><b>Line ID:</b> ${item.lineId}</div>
          <div class="info-item"><b>é›»è©±:</b> ${item.phone}</div>
          <div class="info-item full-row"><b>Email:</b> ${item.email}</div>
          <div class="info-item full-row" style="color:#d35400;"><b>å¡«å–®éœ€æ±‚:</b> ${item.req}</div>
        </div>

        <div class="status-tags">
          <span class="tag">LINE: ${item.lineStatus ? 'âœ…' : 'âŒ'}</span>
          <span class="tag">å·²è®€: ${item.readStatus ? 'âœ…' : 'âŒ'}</span>
          <span class="tag">é€šè©±: ${item.callCount}æ¬¡</span>
          <span class="tag">${item.emailSent ? 'âœ‰ï¸ Emailå·²å¯„' : 'âœ‰ï¸ æœªå¯„ä¿¡'}</span>
        </div>

        <div class="action-grid">
          <a href="tel:${item.phone}" class="btn-tool btn-call"><i>ğŸ“</i>æ’¥é›»è©±</a>
          <a href="https://line.me/ti/p/~${item.lineId}" class="btn-tool btn-line"><i>ğŸ’¬</i>åŠ LINE</a>
          <div class="btn-tool" style="color:#d35400;" onclick="openUpdate('${item.key}')"><i>ğŸ“</i>é€²åº¦</div>
          <div class="btn-tool" style="color:#2980b9;" onclick="openDispatch('${item.key}')"><i>ğŸš€</i>æ´¾å–®</div>
        </div>
      </div>
    `).join('');
  }

  function setFilter(t) {
    currentFilter = t;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('f-'+t).classList.add('active');
    render();
  }

  // ğŸŒŸ æ–°å¢ï¼šæŒ‰éˆ•é»æ“Šå‡½å¼ï¼Œé¿å…å ±éŒ¯
  function openUpdate(key) {
    alert("æ­£åœ¨ç‚ºæ‚¨é–‹å•Ÿå–®è™Ÿ " + key + " çš„é€²åº¦æ›´æ–°è¦–çª—...\n(æ­¤åŠŸèƒ½å³å°‡å®Œæˆ)");
  }

  function openDispatch(key) {
    alert("æ­£åœ¨ç‚ºæ‚¨æº–å‚™å–®è™Ÿ " + key + " çš„æ´¾å–®ä½œæ¥­...\n(æ­¤åŠŸèƒ½å°‡é€£å‹•åˆ° dispatch é é¢)");
  }

  window.onload = loadData;
</script>
</body>
</html>
